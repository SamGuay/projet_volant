{
  "hash": "ef644ad8025043adf504840906690a17",
  "result": {
    "markdown": "---\neditor:\n    markdown:\n        wrap: 72\n---\n\n\n## Ã€ la dÃ©couverte des expressions rÃ©guliÃ¨res avec R (et d'autres packages au passage...)\n\nLes **expressions rÃ©guliÃ¨res** sont communÃ©ment appelÃ©es **regex** ou\n**regexp** pour **regular expressions** en anglais. Selon WikipÃ©dia, une\nexpression rÃ©guliÃ¨re est \"une chaÃ®ne de caractÃ¨res, qui dÃ©crit, selon\nune syntaxe prÃ©cise, un ensemble de chaÃ®nes de caractÃ¨res possibles\". Si\nvous n'avez jamais entendu parlÃ© des regex, il se peut que cette\ndÃ©finition ne vous aide pas Ã  comprendre le concept. Nous tenterons de\ndÃ©mystifier le tout au cours de ces exercices.\n\nÃ€ titre de rappel, cet\n[aide-mÃ©moire](https://raw.githubusercontent.com/rstudio/cheatsheets/main/translations/french/regex_fr.pdf)\nvous sera drÃ´lement utile!\n\nEn rÃ©sumÃ©, ces expressions permettent de dÃ©crire des motifs (patterns) Ã \nl'aide de formules \"*relativement simples*\" pour trouver, valider,\nextraire ou modifier du texte ou des nombres.\n\n## Mission d'aujourd'hui:\n\nRÃ©colter le plus d'information possible qui se trouve dans les tableaux\nde la page suivante:\n<https://tc.canada.ca/fr/aviation/exploitation-aeroports-aerodromes/liste-aeroports-appartenant-transports-canada>.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nâ”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.1 â”€â”€\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nâœ” ggplot2 3.3.6     âœ” purrr   0.3.4\nâœ” tibble  3.1.7     âœ” dplyr   1.0.9\nâœ” tidyr   1.2.0     âœ” stringr 1.4.0\nâœ” readr   2.1.2     âœ” forcats 0.5.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nâ”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€\nâœ– dplyr::filter() masks stats::filter()\nâœ– dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(magrittr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'magrittr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    set_names\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:tidyr':\n\n    extract\n```\n:::\n\n```{.r .cell-code}\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rvest'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nURL <- \"https://tc.canada.ca/fr/aviation/exploitation-aeroports-aerodromes/liste-aeroports-appartenant-transports-canada\"\n```\n:::\n\n\n### DÃ©but de solution en base R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_raw_html <- read_html(x = URL)\nbase_html_table <- html_elements(x = base_raw_html, css = \"table\")\nbase_tables <- html_table(x = base_html_table)\n\n# base_table <- rbind(base_tables[[1]], base_tables[[2]], base_tables[[3]])\n\nnames(base_tables[[3]])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Territoire\"   \"AÃ©roport\"     \"ExploitÃ© par\"\n```\n:::\n:::\n\n\nâš ï¸ Erreur! Une colonne n'est pas nommÃ©e de faÃ§on identique, donc ne\nfonctionne pas... Corrigeons la situation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(base_tables[[3]])[1] <- \"Province/Territoire\"\n\nbase_table <- rbind(base_tables[[1]], base_tables[[2]], base_tables[[3]])\n\nbase_table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 44 Ã— 3\n   `Province/Territoire`  AÃ©roport                `ExploitÃ© par`                \n   <chr>                  <chr>                   <chr>                         \n 1 \"Colombie-Britannique\" Penticton               \"Transports Canada\\n\\t\\t\\t#10â€¦\n 2 \"\"                     Port Hardy              \"Transports Canada\\n\\t\\t\\tC.Pâ€¦\n 3 \"\"                     Sandspit                \"Transports Canada\\n\\t\\t\\tC.Pâ€¦\n 4 \"\"                     Havre de Victoria       \"Transports Canada\\n\\t\\t\\t12,â€¦\n 5 \"Manitoba\"             Churchill               \"Transports Canada\\n\\t\\t\\tC.Pâ€¦\n 6 \"QuÃ©bec\"               Chevery                 \"MunicipalitÃ© de la CÃ´te-Nordâ€¦\n 7 \"\"                     Lourdes-de-Blanc-Sablon \"Transports Canada\\n\\t\\t\\tAirâ€¦\n 8 \"\"                     Sept-ÃŽles               \"Transports Canada\\n\\t\\t\\t100â€¦\n 9 \"\"                     Natashquan              \"MunicipalitÃ© de Natashquan\\nâ€¦\n10 \"\"                     Eastmain River          \"Transports Canada\\n\\t\\t\\ta/sâ€¦\n# â€¦ with 34 more rows\n```\n:::\n\n```{.r .cell-code}\n# Solution en Base R\nbase_table$`Province/Territoire` <- ifelse(test = is.na(base_table$`Province/Territoire`),\n                                  yes = base_table$Territoire, no = base_table$`Province/Territoire`)\nbase_table$Territoire <- NULL\n\nrm(list=(ls(pattern = \"base*\")))\n```\n:::\n\n\n## Solution Ã  la Tidyverse\n\n\n::: {.cell}\n\n```{.r .cell-code}\nURL <- \"https://tc.canada.ca/fr/aviation/exploitation-aeroports-aerodromes/liste-aeroports-appartenant-transports-canada\"\n\n\ntables <- read_html(x = URL) %>%\n    html_elements(css = \"table\") %>%\n    html_table()\n\ntable <- dplyr::bind_rows(tables[[1]],\n                          tables[[2]],\n                          tables[[3]],\n                          .id = \"type\")\n\n# ou solution alternative Ã©quivalente\ntables %>% purrr::map_dfr(bind_rows, .id = \"type\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 44 Ã— 5\n   type  `Province/Territoire`  AÃ©roport               `ExploitÃ© par` Territoire\n   <chr> <chr>                  <chr>                  <chr>          <chr>     \n 1 1     \"Colombie-Britannique\" Penticton              \"Transports Câ€¦ <NA>      \n 2 1     \"\"                     Port Hardy             \"Transports Câ€¦ <NA>      \n 3 1     \"\"                     Sandspit               \"Transports Câ€¦ <NA>      \n 4 1     \"\"                     Havre de Victoria      \"Transports Câ€¦ <NA>      \n 5 1     \"Manitoba\"             Churchill              \"Transports Câ€¦ <NA>      \n 6 1     \"QuÃ©bec\"               Chevery                \"MunicipalitÃ©â€¦ <NA>      \n 7 1     \"\"                     Lourdes-de-Blanc-Sablâ€¦ \"Transports Câ€¦ <NA>      \n 8 1     \"\"                     Sept-ÃŽles              \"Transports Câ€¦ <NA>      \n 9 1     \"\"                     Natashquan             \"MunicipalitÃ©â€¦ <NA>      \n10 1     \"\"                     Eastmain River         \"Transports Câ€¦ <NA>      \n# â€¦ with 34 more rows\n```\n:::\n:::\n\n\n### Remplir les rangÃ©es de la colonne `Province/Territoire`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable <- table %>% dplyr::rename(province_territoire = `Province/Territoire`,\n                        aeroport = AÃ©roport,\n                        exploited_by = `ExploitÃ© par`,\n                        territoire = Territoire)\n\ntable$province_territoire <- dplyr::coalesce(table$province_territoire, \n                                              table$territoire)\n\n\n\ntable[table == \"\"] <- NA\n# equivalent en tidyverse\ntable$province_territoire <- table$province_territoire %>% dplyr::na_if(y = \"\")\ntable <- table %>% tidyr::fill(province_territoire, .direction = \"down\")\n# fill(x)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable <- table %>% dplyr::select(-territoire)\n```\n:::\n\n\nExtraction des codes d'aÃ©roports\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# solution #1\nx <- table %>% mutate(new_col = str_extract(string = aeroport, pattern = \"[A-Z]{3}\"))\n\ntable <- table %>% tidyr::extract(col = aeroport,\n                         into = \"code_aeroport\",\n                         regex = \"(Y[A-Z][A-Z])\", \n                         remove = FALSE)\n\ntable$aeroport <- table$aeroport %>%\n    stringr::str_remove_all(pattern = \"\\\\(.*\\\\)\") %>%\n    stringr::str_squish()\n```\n:::\n\n\n## Recodage des types d'aÃ©roport\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- table %>% mutate(type_nouveau = recode(type,\n                                            \"1\" = \"Petits aÃ©roports\",\n                                            \"2\" = \"AÃ©roports nationaux\", \n                                            \"3\" = \"AÃ©roports nationaux exploitÃ©s par des administrations territoriales\"))\n\nx <- x %>% mutate(type_nouveau_case = case_when(type == 1 ~ \"Petits aÃ©roports\", \n                                               type == 2 ~ \"AÃ©roports nationaux\",\n                                               type == 3 ~ \"AÃ©roports nationaux exploitÃ©s par des administrations territoriales\"))\n```\n:::\n\n\n## Il ne reste plus qu'Ã  extraire l'information qui se trouve dans `table$exploited_by`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(table$exploited_by) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTransports Canada\n\t\t\t#109-3000 Airport Road\n\t\t\tPenticton (Colombie-Britannique)Â  V2A 8X1\n\t\t\t250-770-4414 Transports Canada\n\t\t\tC.P. 460\n\t\t\t3675 Byng Road\n\t\t\tPort Hardy (Colombie-Britannique)Â  V0N 2P0\n\t\t\t250-949-6424 Transports Canada\n\t\t\tC.P. 439\n\t\t\tSandspit (Colombie-Britannique)Â  V0T 1T0\n\t\t\t250-637-1149 Transports Canada\n\t\t\t12, rue Erie\n\t\t\tVictoria (Colombie-Britannique)Â  V8V 1Y4\n\t\t\t250-363-3578 Transports Canada\n\t\t\tC.P. 1059\n\t\t\tChurchill (Manitoba)Â  R0B 0E0\n\t\t\t204-675-8868 MunicipalitÃ© de la CÃ´te-Nord-du Golfe-du Saint-Laurent\n\t\t\tChevery (QuÃ©bec)Â  G0G 1G0\n\t\t\t418-787-2215 Transports Canada\n\t\t\tAirport Road\n\t\t\tLourdes-de-Blanc-Sablon (QuÃ©bec)Â  G0GÂ 1W0\n\t\t\t418-461-2514 Transports Canada\n\t\t\t1000, boul. Laure Est\n\t\t\tC.P. 2001\n\t\t\tSept-ÃŽles (QuÃ©bec)Â  G4R 4K2\n\t\t\t418-962-8211 MunicipalitÃ© de Natashquan\n\t\t\tAirport Road\n\t\t\tNatashquan (QuÃ©bec)Â  G0G 2E0\n\t\t\t418-726-3273 Transports Canada\n\t\t\ta/s du conseil de bande\n\t\t\tEastmain (QuÃ©bec)Â  J0M 1W0\n\t\t\t819-977-0333 Transports Canada\n\t\t\t1550 B, route de l'AÃ©roport\n\t\t\tHavre-Saint-Pierre (QuÃ©bec)\n\t\t\tG0G 1P0\n\t\t\t418-538-0627 Transports Canada\n\t\t\t1-210, chemin de lâ€™AÃ©roport\n\t\t\tHavre-aux-Maisons (QuÃ©bec)\n\t\t\tG4T 5L2\n\t\t\t418-969-2180 Transports Canada\n\t\t\ta/s du conseil de bande\n\t\t\tWaskaganish (QuÃ©bec)Â  J0M 1R0\n\t\t\t819-895-8925 Administration rÃ©gionale Kativik\n\t\t\tC.P. 9\n\t\t\tKuujjuaq (QuÃ©bec)Â  J0M 1C0\n\t\t\t819-964-2968 SociÃ©tÃ© aÃ©roportuaire de Schefferville\n\t\t\t78 Atlantic Road\n\t\t\tSchefferville (QuÃ©bec)Â Â G0G 2T0\n\t\t\t418-585-3544 Transports Canada\n\t\t\ta/s du conseil de bande\n\t\t\tWemindji (QuÃ©bec)Â Â J0M 1L0\n\t\t\t819-978-3936 Transports Canada\n\t\t\t2 Airport Road\n\t\t\tWabush (Terre-Neuve)Â Â A0R 1B0\n\t\t\t709-282-5412 Transports Canada\n\t\t\t1 Airport Road\n\t\t\tSt. Anthony (Terre-Neuve)Â Â A0K 4S0\n\t\t\t709-454-3192 Administration aÃ©roportuaire de Victoria Administration de lâ€™aÃ©roport international de Vancouver Administration aÃ©roportuaire de Prince George Inc. (en anglais seulement) Ville de Kelowna (en anglais seulement) Administration des aÃ©roports rÃ©gionaux dâ€™Edmonton (en anglais seulement) Administration aÃ©roportuaire de Calgary (en anglais seulement) Administration aÃ©roportuaire de Saskatoon (en anglais seulement) Administration aÃ©roportuaire de Regina Administration aÃ©roportuaire de Winnipeg Inc. Administration de lâ€™aÃ©roport international de Thunder Bay Inc. (en anglais seulement) Administration de lâ€™aÃ©roport international du Grand London (en anglais seulement) AutoritÃ© aÃ©roportuaire du Grand Toronto Administration de lâ€™aÃ©roport international Macdonald-Cartier d'Ottawa AÃ©roports de MontrÃ©al AÃ©roports de MontrÃ©al AÃ©roport de QuÃ©bec Inc. Administration de lâ€™aÃ©roport international de Fredericton Administration de lâ€™aÃ©roport international du Grand Moncton Inc. AÃ©roport de Saint John Inc. Administration de lâ€™aÃ©roport de Charlottetown Inc. (en anglais seulement) Administration de lâ€™aÃ©roport international de Halifax Administration de lâ€™aÃ©roport international de Gander Inc. (en anglais seulement) Administration de lâ€™aÃ©roport international de St. Johnâ€™s Gouvernement des Territoires du Nord-Ouest Gouvernement du Nunavut Gouvernement du Yukon\n```\n:::\n:::\n\n\nSeulement si vous en avez envie... ðŸ™ƒ\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}